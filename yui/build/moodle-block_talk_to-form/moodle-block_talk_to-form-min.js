YUI.add("moodle-block_talk_to-form",function(e,t){M.block_talk_to=M.block_talk_to||{},M.block_talk_to.form={overlay:null,init:function(){e.all(".talk_to_link").on("click",this.show_form,this)},show_response:function(t){this.overlay||(this.overlay=new M.core.dialogue({visible:!1,modal:!0,close:!0,draggable:!1,width:"50%"}),this.overlay.render()),this.overlay.set("bodyContent",e.Node.create(t)),this.overlay.show()},hide_response:function(){this.overlay.hide()},show_form:function(t){t.preventDefault(),this.xhr=e.io(t.currentTarget.get("href"),{method:"GET",context:this,on:{success:function(t,n){response=e.JSON.parse(n.responseText),this.show_response(response.output),response.script.length>0&&(script=e.one("#talk_to_dynamic_script"),script&&script.remove(),el=document.createElement("script"),el.id="ilp_dynamic_script",el.textContent=response.script,document.body.appendChild(el)),e.one("#mform1").on("submit",M.block_talk_to.form.submit_form),e.one("#id_message").focus()},failure:function(e,t){this.show_response(t.responseText)}}})},submit_form:function(t){t.preventDefault();var n=document.getElementById("mform1");this.xhr=e.io(t.target.get("action"),{method:"POST",context:this,form:n,on:{success:function(t,n){response=e.JSON.parse(n.responseText),M.block_talk_to.form.show_response(response.output)},failure:function(e,t){M.block_talk_to.form.show_response(t.responseText)}}})}}},"@VERSION@",{requires:["base","io","io-form","node","json","moodle-core-notification"]});
